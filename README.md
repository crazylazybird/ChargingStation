# ðŸš—ðŸ’¡ ChargingStation â€“ Ð¿Ñ€Ð¾Ñ‚Ð¾Ñ‚Ð¸Ð¿ ÑÑ‚Ð°Ð½Ñ†Ð¸Ð¸ Ð·Ð°Ñ€ÑÐ´ÐºÐ¸ ÑÐ»ÐµÐºÑ‚Ñ€Ð¾Ð¼Ð¾Ð±Ð¸Ð»ÐµÐ¹

ÐŸÑ€Ð¾ÐµÐºÑ‚ Ñ€ÐµÐ°Ð»Ð¸Ð·ÑƒÐµÑ‚ Ð¸Ð½Ñ‚ÐµÐ³Ñ€Ð°Ñ†Ð¸ÑŽ **POS-Ñ‚ÐµÑ€Ð¼Ð¸Ð½Ð°Ð»Ð° Vendotek** (Ð¿Ð¾ Ð¿Ñ€Ð¾Ñ‚Ð¾ÐºÐ¾Ð»Ñƒ **VTK 1.23**) Ñ **ESP32** Ð¸ **Arduino** Ð´Ð»Ñ ÑƒÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ñ Ð·Ð°Ñ€ÑÐ´Ð½Ð¾Ð¹ ÑÑ‚Ð°Ð½Ñ†Ð¸ÐµÐ¹.  
ESP32 Ð²Ñ‹ÑÑ‚ÑƒÐ¿Ð°ÐµÑ‚ ÐºÐ°Ðº **VMC (Vending Machine Controller)**, Arduino ÑÐ¼ÑƒÐ»Ð¸Ñ€ÑƒÐµÑ‚ Ð¿Ñ€Ð¸ÐºÐ»Ð°Ð´Ñ‹Ð²Ð°Ð½Ð¸Ðµ ÐºÐ°Ñ€Ñ‚Ñ‹ Ðº Ð·Ð°Ñ€ÑÐ´Ð½Ð¾Ð¼Ñƒ ÐºÐ¾Ð½Ñ‚Ñ€Ð¾Ð»Ð»ÐµÑ€Ñƒ Ñ‡ÐµÑ€ÐµÐ· Ñ€ÐµÐ»Ðµ.

---

## ðŸ”„ ÐŸÐ¾Ñ‚Ð¾Ðº ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ð¹ (ÐºÐ°Ðº ÑÑ‚Ð¾ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚)

### 1. Ð’Ñ‹Ð±Ð¾Ñ€ ÑÑƒÐ¼Ð¼Ñ‹ Ð½Ð° Ñ‚ÐµÑ€Ð¼Ð¸Ð½Ð°Ð»Ðµ
- ÐŸÐ¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ Ð²Ñ‹Ð±Ð¸Ñ€Ð°ÐµÑ‚ ÑÑƒÐ¼Ð¼Ñƒ (Ð½Ð°Ð¿Ñ€Ð¸Ð¼ÐµÑ€, **1500 â‚½**).
- Ð¢ÐµÑ€Ð¼Ð¸Ð½Ð°Ð» Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð»ÑÐµÑ‚ Ð½Ð° ESP32 ÑÐ»ÑƒÐ¶ÐµÐ±Ð½Ð¾Ðµ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ (STP/IDL).

### 2. Ð—Ð°Ð¿Ñ€Ð¾Ñ Ð½Ð° ÑÐ¿Ð¸ÑÐ°Ð½Ð¸Ðµ (VRP)
- ESP32 Ñ„Ð¾Ñ€Ð¼Ð¸Ñ€ÑƒÐµÑ‚ **VTK-Ð¿Ð°ÐºÐµÑ‚ `VRP`** Ñ ÑƒÐºÐ°Ð·Ð°Ð½Ð½Ð¾Ð¹ ÑÑƒÐ¼Ð¼Ð¾Ð¹.  
- ÐŸÐ°ÐºÐµÑ‚ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð»ÑÐµÑ‚ÑÑ Ð½Ð° Ñ‚ÐµÑ€Ð¼Ð¸Ð½Ð°Ð».

### 3. ÐžÐ¿Ð»Ð°Ñ‚Ð° Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¼
- ÐŸÐ¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ Ð¾Ð¿Ð»Ð°Ñ‡Ð¸Ð²Ð°ÐµÑ‚ Ð½Ð° Ñ‚ÐµÑ€Ð¼Ð¸Ð½Ð°Ð»Ðµ.
- Ð’Ð¾Ð·Ð¼Ð¾Ð¶Ð½Ñ‹Ðµ Ð¸ÑÑ…Ð¾Ð´Ñ‹:
  - âœ… **Ð£ÑÐ¿ÐµÑ…** â†’ Ñ‚ÐµÑ€Ð¼Ð¸Ð½Ð°Ð» Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°ÐµÑ‚ Ð¿Ð¾Ð»Ð¾Ð¶Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ð¹ Ð¾Ñ‚Ð²ÐµÑ‚ (`VRP Response`).
  - âŒ **ÐžÑ‚ÐºÐ°Ð· / Ð½ÐµÐ´Ð¾ÑÑ‚Ð°Ñ‚Ð¾Ñ‡Ð½Ð¾ ÑÑ€ÐµÐ´ÑÑ‚Ð² / Ñ‚Ð°Ð¹Ð¼Ð°ÑƒÑ‚** â†’ Ñ‚ÐµÑ€Ð¼Ð¸Ð½Ð°Ð» Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°ÐµÑ‚ Ð¾ÑˆÐ¸Ð±ÐºÑƒ.

### 4. Ð¡Ñ‚Ð°Ñ€Ñ‚ Ð·Ð°Ñ€ÑÐ´ÐºÐ¸ (Ð¿Ñ€Ð¸ ÑƒÑÐ¿ÐµÑ…Ðµ Ð¾Ð¿Ð»Ð°Ñ‚Ñ‹)
- ESP32 Ð¿ÐµÑ€ÐµÐºÐ»ÑŽÑ‡Ð°ÐµÑ‚ÑÑ Ð² ÑÐ¾ÑÑ‚Ð¾ÑÐ½Ð¸Ðµ **Paid / Active**.
- ÐŸÐ¾ÑÑ‹Ð»Ð°ÐµÑ‚ ÐºÐ¾Ð¼Ð°Ð½Ð´Ñƒ Arduino:
  - **Ð—Ð°Ð¼ÐºÐ½ÑƒÑ‚ÑŒ Ñ€ÐµÐ»Ðµ** â†’ ÑÑ‚Ð°Ð½Ñ†Ð¸Ñ Ð²Ð¸Ð´Ð¸Ñ‚ â€œÐºÐ°Ñ€Ñ‚Ñƒ Ñ Ð±ÐµÑÐºÐ¾Ð½ÐµÑ‡Ð½Ñ‹Ð¼ Ð±Ð°Ð»Ð°Ð½ÑÐ¾Ð¼â€.  
  - Ð—Ð°Ñ€ÑÐ´ÐºÐ° Ð½Ð°Ñ‡Ð¸Ð½Ð°ÐµÑ‚ÑÑ.  
  - Ð”Ð°Ð»ÐµÐµ Arduino Ð¼Ð¾Ð¶ÐµÑ‚ Ñ€Ð°Ð·Ð¾Ð¼ÐºÐ½ÑƒÑ‚ÑŒ Ñ€ÐµÐ»Ðµ, Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð·Ð°Ð²ÐµÑ€ÑˆÐ¸Ñ‚ÑŒ "ÑÐ¼ÑƒÐ»ÑÑ†Ð¸ÑŽ".

### 5. ÐšÐ¾Ð½Ñ‚Ñ€Ð¾Ð»ÑŒ ÑÐµÑÑÐ¸Ð¸
- ÐŸÐ¾ÐºÐ° Ð¸Ð´Ñ‘Ñ‚ Ð·Ð°Ñ€ÑÐ´ÐºÐ°:
  - ESP32 ÑÑ‡Ð¸Ñ‚Ð°ÐµÑ‚ Ð¸Ð·Ñ€Ð°ÑÑ…Ð¾Ð´Ð¾Ð²Ð°Ð½Ð½Ñ‹Ðµ ÑÑ€ÐµÐ´ÑÑ‚Ð²Ð° (Ð¿Ð¾ ÐºÐ’Ñ‚Â·Ñ‡).  
- Ð•ÑÐ»Ð¸ Ð±Ð°Ð»Ð°Ð½Ñ Ð¸Ð·Ñ€Ð°ÑÑ…Ð¾Ð´Ð¾Ð²Ð°Ð½:
  - ESP32 Ð´Ð°Ñ‘Ñ‚ Arduino ÐºÐ¾Ð¼Ð°Ð½Ð´Ñƒ ÑÐ½Ð¾Ð²Ð° Ð¿ÐµÑ€ÐµÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒ Ñ€ÐµÐ»Ðµ.  
  - Ð¡Ñ‚Ð°Ð½Ñ†Ð¸Ñ Ð¾ÑÑ‚Ð°Ð½Ð°Ð²Ð»Ð¸Ð²Ð°ÐµÑ‚ Ð·Ð°Ñ€ÑÐ´ (ÑÑ„Ñ„ÐµÐºÑ‚ Ð¿Ð¾Ð²Ñ‚Ð¾Ñ€Ð½Ð¾Ð³Ð¾ Ð¿Ñ€Ð¸ÐºÐ»Ð°Ð´Ñ‹Ð²Ð°Ð½Ð¸Ñ ÐºÐ°Ñ€Ñ‚Ñ‹).

### 6. Ð”Ð¾ÑÑ€Ð¾Ñ‡Ð½Ð°Ñ Ð¾ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¼
- Ð•ÑÐ»Ð¸ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ ÑÐ½Ð¸Ð¼Ð°ÐµÑ‚ Ð¿Ð¸ÑÑ‚Ð¾Ð»ÐµÑ‚ Ñ€Ð°Ð½ÑŒÑˆÐµ:
  - ESP32 Ñ„Ð¸ÐºÑÐ¸Ñ€ÑƒÐµÑ‚ Ð¾ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÑƒ.  
  - Ð’Ñ‹Ñ‡Ð¸ÑÐ»ÑÐµÑ‚ Ð¾ÑÑ‚Ð°Ñ‚Ð¾Ðº (Ð½ÐµÐ¸Ð·Ñ€Ð°ÑÑ…Ð¾Ð´Ð¾Ð²Ð°Ð½Ð½Ñ‹Ðµ â‚½).  
  - ÐžÑ‚Ð¿Ñ€Ð°Ð²Ð»ÑÐµÑ‚ Ð½Ð° Ñ‚ÐµÑ€Ð¼Ð¸Ð½Ð°Ð» **FIN** Ñ Ñ„Ð°ÐºÑ‚Ð¸Ñ‡ÐµÑÐºÐ¾Ð¹ ÑÑƒÐ¼Ð¼Ð¾Ð¹.  
  - ÐŸÐ¾ÑÐ»Ðµ Ð¿Ð¾Ð´Ñ‚Ð²ÐµÑ€Ð¶Ð´ÐµÐ½Ð¸Ñ Ð¾ÑÑ‚Ð°Ñ‚Ð¾Ðº Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°ÐµÑ‚ÑÑ, ÑÐµÑÑÐ¸Ñ Ð·Ð°ÐºÑ€Ñ‹Ð²Ð°ÐµÑ‚ÑÑ.

### 7. ÐžÑˆÐ¸Ð±ÐºÐ° / Ð¾Ñ‚ÐºÐ°Ð· Ð² Ð¾Ð¿Ð»Ð°Ñ‚Ðµ
- Ð•ÑÐ»Ð¸ `VRP` Ð½Ðµ Ð¾Ð´Ð¾Ð±Ñ€ÐµÐ½ Ð¸Ð»Ð¸ Ð¾ÑˆÐ¸Ð±ÐºÐ° CRC:
  - ESP32 Ð·Ð°Ð²ÐµÑ€ÑˆÐ°ÐµÑ‚ ÑÐµÑÑÐ¸ÑŽ Ð² ÑÐ¾ÑÑ‚Ð¾ÑÐ½Ð¸Ð¸ **Error**.  
  - Ð—Ð°Ñ€ÑÐ´ÐºÐ° Ð½Ðµ Ð·Ð°Ð¿ÑƒÑÐºÐ°ÐµÑ‚ÑÑ.

---

## ðŸ“Š ÐœÐ°ÑˆÐ¸Ð½Ð° ÑÐ¾ÑÑ‚Ð¾ÑÐ½Ð¸Ð¹

```mermaid
stateDiagram-v2
    [*] --> IDLE
    
    IDLE --> WAIT_PAYMENT: Ð²Ñ‹Ð±Ñ€Ð°Ð½Ð° ÑÑƒÐ¼Ð¼Ð°
    WAIT_PAYMENT --> CHARGING: OK Ð¾Ñ‚ Ñ‚ÐµÑ€Ð¼Ð¸Ð½Ð°Ð»Ð° (VRP)
    WAIT_PAYMENT --> IDLE: Ð¾Ñ‚ÐºÐ°Ð·/Ð¾ÑˆÐ¸Ð±ÐºÐ° Ð¾Ð¿Ð»Ð°Ñ‚Ñ‹
    
    CHARGING --> REFUND: ÑÐ½ÑÐ»Ð¸ Ð¿Ð¸ÑÑ‚Ð¾Ð»ÐµÑ‚
    REFUND --> IDLE: Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‚ Ð¾ÑÑ‚Ð°Ñ‚ÐºÐ°
    
    CHARGING --> STOP: Ð±Ð°Ð»Ð°Ð½Ñ Ð¸ÑÑ‡ÐµÑ€Ð¿Ð°Ð½
    STOP --> IDLE
    
    CHARGING --> ERROR: Ð¾ÑˆÐ¸Ð±ÐºÐ° ÑÐ²ÑÐ·Ð¸/ÑÑ‡Ñ‘Ñ‚Ñ‡Ð¸ÐºÐ°
    ERROR --> STOP
    STOP --> IDLE
